(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{740:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return x}});var l=a(9268),s=a(5540);a(5483);var i=a(4214);a(6394);var r=a(6006);a(8431);var t=a(828),o=a(4245);a(8357),a(3023);var c=e=>{let{value:n,handleChange:a}=e,[s,i]=r.useState(()=>(console.log(n),c(n))?t.EditorState.createWithContent((0,t.convertFromRaw)(JSON.parse(n))):t.EditorState.createWithContent(t.ContentState.createFromBlockArray((0,t.convertFromHTML)("<p>".concat(n,"</p>")))));function c(e){try{return JSON.parse(e)&&!!e}catch(e){return!1}}(0,r.useEffect)(()=>{n&&(c(n)?i(t.EditorState.createWithContent((0,t.convertFromRaw)(JSON.parse(n)))):i(t.EditorState.createWithContent(t.ContentState.createFromBlockArray((0,t.convertFromHTML)("<p>".concat(n,"</p>"))))))},[n]);let d=async e=>{i(e);let n=s.getCurrentContent();a(JSON.stringify((0,t.convertToRaw)(n)))};return(0,l.jsx)("div",{className:"textarea",children:(0,l.jsx)(o.Editor,{locale:"ru",editorState:s,onEditorStateChange:d,wrapperClassName:"wrapper-class",toolbarClassName:"toolbar-class",editorClassName:"editor-class",toolbar:{options:["inline","blockType","fontSize","fontFamily","textAlign","link","emoji","remove","history"]}})})},d=a(6008);let u={housing:"apartment",region:"",rooms:0,price:0,adress:"",description:"",material:"",year:"",floor:0,floors:0,state:"",roofing:"",sewerage:"",fencing:"",electricity:"",heating:"",gas:"",water:"",plot:"",realtor:{name:"",phone:""},area:{total:"",kitchen:"",living:""},bathroom:"",balcony:{value:"",glazed:!1},telephone:"",internet:"",furnished:"",commercial:{purpose:"",placement:""}},m={type:"success",title:"Объявление успешно создано"},h={type:"success",title:"Объявление успешно изменена"},p={type:"fail",title:"Что-то пошло не так",subtitle:"Попробуйте позже или обновите страницу."};var x=e=>{var n,a,t,o;let{post:x=null}=e,v=(0,d.useRouter)(),[g,f]=(0,r.useState)(u),[b,N]=(0,r.useState)(null),[C,y]=(0,r.useState)([]),[w,S]=(0,r.useState)(null),_=async()=>{let{data:e}=await i.Z.get("/api/regions",{validateStatus:function(e){return!0},headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"}});N(e)};(0,r.useEffect)(()=>{b?x&&x._id||f({...g,region:b[0].name}):_()},[b]),(0,r.useEffect)(()=>{if(x&&x._id){f({...g,...x,region:x.region.name,housing:x.housing.slug});let e=[];for(let n=0;n<x.images.length;n++)e.push("/uploads/"+x.images[n]);y([...e])}},[x]);let k=e=>{let{name:n,value:a}=e.currentTarget;if(n.includes("_")){let e=n.split("_"),l=e[0],s=e[1];f({...g,[l]:{...g[l],[s]:a}})}else f({...g,[n]:a})},E=e=>new Promise(n=>setTimeout(n,e)),F=async()=>{let e=new FormData;for(let n in g){let a=g[n];if("object"==typeof a)for(let l in a){let a=g[n][l];e.append("".concat(n,"[").concat(l,"]"),a)}else e.append(n,a)}for(let n=0;n<C.length;n++){let a=C[n].split("/uploads/")[1];x&&x.images.includes(a)&&e.append("images",a)}if(O.map(n=>{e.append("images",n)}),x&&x._id){let{data:n,status:a}=await i.Z.patch("/api/posts/".concat(x._id),e,{validateStatus:function(e){return!0},headers:{"Content-Type":"multipart/form-data"}});200===a?(f({...g,...n,region:n.region.name,housing:n.housing.slug}),S(h)):S(p)}else{let{data:n,status:a}=await i.Z.post("/api/posts",e,{validateStatus:function(e){return!0},headers:{"Content-Type":"multipart/form-data"}});200===a?(S(m),await E(3e3),v.push("/admin/posts/".concat(n._id))):S(p)}},[O,T]=(0,r.useState)([]),[q,D]=(0,r.useState)(0),A=e=>{let n=!1,a=C[e],l=C[e].split("/uploads/")[1];if(x.images&&x.images.includes(l)&&(n=!0),!n){let n=O[e];T(O.filter(e=>e!=n))}y(C.filter(e=>e!=a)),D(Math.max(0,e-1))};return(0,l.jsxs)("div",{id:"postForm",children:[(0,l.jsx)(j,{text:w,setText:S}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),F()},children:[(0,l.jsxs)("div",{className:"inputs",children:[(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col",children:[(0,l.jsxs)("div",{className:"images-container",children:[(0,l.jsx)("div",{className:"current-image",children:C&&C.length>0&&C[q]?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("img",{src:C[q],alt:"prev"}),(0,l.jsx)("i",{className:"delete",onClick:e=>{e.preventDefault(),A(q)}})]}):(0,l.jsx)("div",{className:"noimage",children:"Нет изображения"})}),(0,l.jsx)("div",{className:"images",children:C&&C.map((e,n)=>(0,l.jsx)("div",{className:"img ".concat(q===n?"active":""," "),onClick:e=>{e.preventDefault(),D(n)},children:(0,l.jsx)("img",{src:e,alt:"prev".concat(n)})},n))})]}),(0,l.jsxs)("div",{className:"btns",children:[(0,l.jsx)("div",{className:"btn clear",onClick:e=>{e.preventDefault(),T([]),y([]),D(0)},children:"Очистить изображения"}),(0,l.jsxs)("label",{className:"btn save",children:["Загрузить",(0,l.jsx)("input",{type:"file",multiple:!0,name:"images",onChange:e=>{let n=e.target.files,a=[],l=[];for(let e=0;e<n.length;e++){let s=n[e],i=s.type,r=["image/jpeg","image/png","image/webp"];r.includes(i)&&(a.push(s),l.push(URL.createObjectURL(s)))}T([...O,...a]),y([...C,...l])}})]})]})]}),(0,l.jsxs)("div",{className:"col",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Имя Риелтора"}),(0,l.jsx)("input",{type:"text",name:"realtor_name",required:!0,value:g.realtor.name,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Тел. Номер Риелтора"}),(0,l.jsx)("input",{type:"text",name:"realtor_phone",value:g.realtor.phone,onChange:k,required:!0})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Тип недвижимости"}),(0,l.jsxs)("select",{disabled:x&&x._id,name:"housing",value:g.housing,required:!0,onChange:k,children:[(0,l.jsx)("option",{value:"apartment",children:"Квартира"}),(0,l.jsx)("option",{value:"house",children:"Дом"}),(0,l.jsx)("option",{value:"commercial",children:"Коммерческая недвижимость"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Район"}),(0,l.jsx)("select",{name:"region",value:g.region,onChange:k,required:!0,children:b&&b.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e._id))})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Адрес"}),(0,l.jsx)("input",{type:"text",name:"adress",required:!0,value:g.adress,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Цена"}),(0,l.jsx)("input",{type:"number",name:"price",value:g.price,onChange:k,required:!0})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Год построки:"}),(0,l.jsx)("input",{type:"text",name:"year",value:g.year,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Количество комнат:"}),(0,l.jsx)("input",{type:"number",name:"rooms",value:g.rooms,onChange:k,required:!0})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Этаж:"}),(0,l.jsx)("input",{type:"number",name:"floor",value:g.floor,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Этажей в зданий:"}),(0,l.jsx)("input",{type:"number",name:"floors",value:g.floors,onChange:k})]})]})]}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"form-group number",required:!0,children:[(0,l.jsx)("label",{children:"Общая площадь:"}),(0,l.jsx)("input",{type:"text",name:"area_total",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:g.area.total,onChange:k})]}),"commercial"!==g.housing&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Жилая площадь:"}),(0,l.jsx)("input",{type:"text",name:"area_living",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:g.area.living,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Площадь кухни:"}),(0,l.jsx)("input",{type:"text",name:"area_kitchen",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:g.area.kitchen,onChange:k})]})]}),"house"===g.housing&&(0,l.jsxs)("div",{className:"form-group number",children:[(0,l.jsx)("label",{children:"Участок (сот.):"}),(0,l.jsx)("input",{type:"text",name:"plot",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:g.area.kitchen,onChange:k})]})]}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Тип строения"}),(0,l.jsxs)("select",{name:"material",value:g.material,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.gU.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Состояние"}),(0,l.jsxs)("select",{name:"state",value:g.state,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.PO.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Санузел"}),(0,l.jsxs)("select",{name:"bathroom",value:g.bathroom,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.fe.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Мебилирована"}),(0,l.jsxs)("select",{name:"furnished",value:g.furnished,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.pd.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Интернет"}),(0,l.jsxs)("select",{name:"internet",value:g.internet,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.rS.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Телефон"}),(0,l.jsxs)("select",{name:"telephone",value:g.telephone,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.Dl.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Балкон"}),(0,l.jsxs)("select",{name:"balcony",value:null===(n=g.balcony)||void 0===n?void 0:n.value,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.Yf.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsx)("div",{className:"form-group check",children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"checkbox",name:"balcony_glazed",id:"",value:null===(a=g.balcony)||void 0===a?void 0:a.glazed,onChange:k}),"Балкон остеклен"]})})]}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Электричество"}),(0,l.jsxs)("select",{name:"electricity",value:g.electricity,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.$5.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Канализация"}),(0,l.jsxs)("select",{name:"sewerage",value:g.sewerage,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.j$.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Газ"}),(0,l.jsxs)("select",{name:"gas",value:g.gas,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.OV.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Питьевая вода"}),(0,l.jsxs)("select",{name:"water",value:g.water,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.aU.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Отопление"}),(0,l.jsxs)("select",{name:"heating",value:g.heating,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.uJ.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Покрытие крыши"}),(0,l.jsx)("input",{type:"text",name:"roofing",value:g.roofing,onChange:k})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Как огорожен участок"}),(0,l.jsx)("input",{type:"text",name:"fencing",value:g.fencing,onChange:k})]})]}),"commercial"===g.housing&&(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Назначение"}),(0,l.jsxs)("select",{name:"commercial_purpose",required:!0,value:null===(t=g.commercial)||void 0===t?void 0:t.purpose,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.Kp.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Где размещен объект"}),(0,l.jsxs)("select",{name:"commercial_placement",value:null===(o=g.commercial)||void 0===o?void 0:o.placement,onChange:k,children:[(0,l.jsx)("option",{value:"",children:"не важно"}),s.ky.map((e,n)=>(0,l.jsx)("option",{value:e,children:e},n))]})]})]}),(0,l.jsx)(c,{value:g.description,handleChange:e=>{f({...g,description:e})}})]}),(0,l.jsxs)("div",{className:"btns",children:[(0,l.jsx)("div",{className:"btn clear",onClick:e=>{e.preventDefault(),x&&x._id?f({...u,...x,region:x.region.name,housing:x.housing.slug}):f(u)},children:x&&x._id?"Сбросить изменения":"Очистить"}),(0,l.jsx)("input",{type:"submit",className:"btn save",value:"Сохранить"})]})]})]})};let j=e=>{let{text:n,setText:a}=e;if(n)return(0,l.jsx)("div",{className:"modal",children:(0,l.jsxs)("div",{className:"content ".concat(null==n?void 0:n.type),children:[(0,l.jsx)("i",{}),(0,l.jsxs)("div",{className:"text",children:[(0,l.jsx)("div",{className:"title",children:null==n?void 0:n.title}),n&&n.subtitle&&(0,l.jsx)("div",{className:"subtitle",children:n.subtitle})]}),(0,l.jsx)("div",{className:"btn",onClick:e=>{e.preventDefault(),a(null)},children:"ОК"})]})})}},5540:function(e,n,a){"use strict";a.d(n,{$5:function(){return p},Dl:function(){return r},Kp:function(){return d},OV:function(){return x},PO:function(){return s},Yf:function(){return t},aU:function(){return j},fe:function(){return c},gU:function(){return l},j$:function(){return h},ky:function(){return u},pd:function(){return i},rS:function(){return o},uJ:function(){return m}});let l=["кирпичный","панельный","монолитный","деревянный","каркасно-камышитовый","пеноблочный","сэндвич-панели","каркасно-щитовой","шлакоблочный","иное"],s=["хорошое","среднее","требует ремонта","свободная планировка","черновая отделка"],i=["полностью","частично","без мебели"],r=["отдельный","блокиратор","есть возможность подключения","нет"],t=["балкон","лоджия","далкон и лоджия","несколько балконов и лоджий"],o=["оптика","проводной","ADSL","через TV кабель"],c=["раздельный","совмещенный","2 с/у и более","нет","во дворе"],d=["свободное назначение","офисы","магазины и бутики","склады","автосервисы и автомойки","общепит","салон красоты"],u=["в бизнец-центре","в жилом доме или ЖК","в торговом центре","на универсальном рынке","отдельностоящее здание"],m=["центральное","на газе","на твердом топливе","на жидком топливе","смешанное","без отопления"],h=["центральная","есть возможность подведения","септик","нет"],p=["есть","есть возможность подключения","нет"],x=["магистральный","автономный","есть возможность подключения","нет"],j=["центральное водоснабжение","есть возможность подключения","скважина","нет"]},9113:function(){},5483:function(){},8357:function(){}}]);